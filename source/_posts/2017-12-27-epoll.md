---
type: "tags"
layout: "tags"
title: epoll/select/poll 原理
date: 2017-10-04 15:45:20
category: Haprxoy
toc: true
tags:
    - linux
    - tcp/ip

description: epoll/select/poll简单汇总
comments: true
---

poll和select的实现基本上是一致的，只是传递参数有所不同，他们的基本流程如下：

  1. 复制用户数据到内核空间

  2. 估计超时时间

  3. 遍历每个文件并调用f_op->poll 取得文件当前就绪状态， 如果前面遍历的文件都没有就绪，向文件插入wait_queue节点

  4. 遍历完成后检查状态：

          a). 如果已经有就绪的文件转到5；

          b). 如果有信号产生，重启poll或select（转到 1或3）；

          c). 否则挂起进程等待超时或唤醒，超时或被唤醒后再次遍历所有文件取得每个文件的就绪状态

  5. 将所有文件的就绪状态复制到用户空间

  6. 清理申请的资源

epoll原理：
  epoll的效率比select和poll更高的一个重要原因就在于就绪检查时只需要遍历已就绪的事件，通过上述分析，也验证了其原理。

  epoll在实现”epoll_wait()”的时候，不需要去遍历所有的事件, 它通过回调机制把就绪事件主动拷贝到就绪队列”rdllist”中。

  另外，epoll有效地利用Linux内核的等待队列，可以在有事件就绪时可以及时唤醒阻塞在”epoll_wait()”上的进程。
